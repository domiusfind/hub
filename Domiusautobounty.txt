getgenv().AutoBountyEnabled = true

if getgenv().AutoBountyEnabled then
    getgenv().AutoBounty = {
        Settings = {
            AutoV4 = true,
            SkipRaceV4 = true,
            LowHealth = 4500,
        },
        Weapons = {
            Melee = {
                Enable = true,
                Z = {true, 0.7},
                X = {true, 0.0},
                C = {true, 0.0}
            },
            Sword = {
                Enable = true,
                Z = {true, 1.5},
                X = {true, 0.0}
            },
            BloxFruit = {
                Enable = false,
                Z = {true, 0},
                X = {false, 0},
                C = {false, 0},
                V = {false, 0},
                F = {true, 0.3}
            }
        }
    }

    repeat task.wait() until game:IsLoaded()
    local plr = game.Players.LocalPlayer

    -- Proteção contra scripts suspeitos
    local function DestroySuspiciousScripts()
        for _, obj in pairs(workspace:GetDescendants()) do
            if obj:IsA("LocalScript") or obj:IsA("Script") then
                if obj.Name:lower():find("script") or obj.Name:lower():find("detector") or obj.Name:lower():find("anti") then
                    pcall(function() obj:Destroy() end)
                end
            end
        end

        workspace.DescendantAdded:Connect(function(obj)
            if obj:IsA("LocalScript") or obj:IsA("Script") then
                if obj.Name:lower():find("script") or obj.Name:lower():find("detector") or obj.Name:lower():find("anti") then
                    pcall(function() obj:Destroy() end)
                end
            end
        end)
    end

    DestroySuspiciousScripts()

    local function EquipTool(name)
        local tool = plr.Backpack:FindFirstChild(name) or plr.Backpack:FindFirstChildWhichIsA("Tool")
        if tool then
            plr.Character.Humanoid:EquipTool(tool)
        end
    end

    local function GetDistance(pos)
        return (plr.Character.HumanoidRootPart.Position - pos).Magnitude
    end

    local function InCombat()
        local gui = plr.PlayerGui:FindFirstChild("Main")
        return gui and gui.InCombat.Visible and gui.InCombat.Text:lower():find("risk")
    end

    local function TweenTo(cf)
        local ts = game:GetService("TweenService")
        local dist = GetDistance(cf.Position)
        local info = TweenInfo.new(dist / 300, Enum.EasingStyle.Linear) -- velocidade ajustada para 300
        local tween = ts:Create(plr.Character.HumanoidRootPart, info, {CFrame = cf})
        tween:Play()
        return tween
    end

    local function LookAt(target)
        local cam = workspace.CurrentCamera
        local tHRP = target.Character:FindFirstChild("HumanoidRootPart")
        if tHRP then
            cam.CFrame = CFrame.new(cam.CFrame.Position, tHRP.Position)
        end
    end

    local function GetTarget()
        for _, v in pairs(game.Players:GetPlayers()) do
            if v ~= plr and v.Team ~= plr.Team and v.Character and v.Character:FindFirstChild("Humanoid") and v.Character.Humanoid.Health > 0 then
                if not getgenv().AutoBounty.Settings.SkipRaceV4 or not (v.Backpack:FindFirstChild("Awakening") or v.Character:FindFirstChild("Awakening")) then
                    if math.abs(v.Data.Level.Value - plr.Data.Level.Value) < 300 then
                        return v
                    end
                end
            end
        end
    end

    local function Attack(target)
        if not target or not target.Character or target.Character.Humanoid.Health <= 0 then return end

        local tHRP = target.Character:FindFirstChild("HumanoidRootPart")
        if not tHRP then return end

        -- Suaviza a movimentação até perto do inimigo
        TweenTo(tHRP.CFrame * CFrame.new(0, 5, -5)) -- posiciona levemente atrás/alto do inimigo
        LookAt(target)

        -- Ativa habilidades
        for wType, config in pairs(getgenv().AutoBounty.Weapons) do
            if config.Enable then
                EquipTool(wType)
                for key, val in pairs(config) do
                    if key ~= "Enable" and val[1] then
                        task.spawn(function()
                            game:GetService("VirtualInputManager"):SendKeyEvent(true, key, false, game)
                            task.wait(val[2])
                            game:GetService("VirtualInputManager"):SendKeyEvent(false, key, false, game)
                        end)
                    end
                end
            end
        end

        -- Simula ataque básico
        game:GetService("VirtualUser"):CaptureController()
        game:GetService("VirtualUser"):Button1Down(Vector2.new(0, 1, 0, 1))
    end

    -- Loop principal
    task.spawn(function()
        while task.wait(1) do
            local target = GetTarget()
            if target then
                if getgenv().AutoBounty.Settings.AutoV4 then
                    game:GetService("VirtualInputManager"):SendKeyEvent(true, "Y", false, game)
                    task.wait(1)
                    game:GetService("VirtualInputManager"):SendKeyEvent(false, "Y", false, game)
                end
                Attack(target)
            end
        end
    end)
end
